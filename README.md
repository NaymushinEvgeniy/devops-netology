# Домашнее задание к занятию "4.2. Использование Python для решения типовых DevOps задач"

### Задача 1
Опишите кратко, как вы поняли: в чем основное отличие полной (аппаратной) виртуализации, паравиртуализации и виртуализации на основе ОС

Это отличие в уровнях абстракции виртуализации структурных составляющих ОС
 - В полной виртуализации задачи по абстракции выполняет хостовое оборудование
 - В паравиртуализации - вся хостовая операционная система
 - В виртуализации на основе ОС - исключительно за счет средств ядра ОС (namespaces)
### Задача 2
Выберите один из вариантов использования организации физических серверов, в зависимости от условий использования.

Физические сервера - Высоконагруженная база данных, чувствительная к отказу.
Потенциально высокий критерий отзывчивости ресурсов чтения/записи, высокие требования к оперативной памяти, ввиду чего
использование дополнительных виртуальных сред на хосте крайне нежелательно

Физические сервера - Системы, выполняющие высокопроизводительные расчеты на GPU.
Накладные расходы на виртуализацию GPU-устройств приведут к снижению ее эффективности

Паравиртуализация - Windows системы для использования бухгалтерским отделом.
Удобство распределиния аппаратных ресурсов вкупе с лицензионой политикой, удобство миграциии с одного оборудования на 
другое в случае выходов из строя, удобство хранения резервных копий

Виртуализация уровня ОС. - Различные web-приложения.
Удобство задач по масштабированию сервисов, настроек балансировкой нагрузки, изолированность приложений друг от друга,
легковесность образов

### Задача 3
Выберите подходящую систему управления виртуализацией для предложенного сценария. Детально опишите ваш выбор.
- 100 виртуальных машин на базе Linux и Windows, общие задачи, нет особых требований. Преимущественно Windows based инфраструктура, требуется реализация программных балансировщиков нагрузки, репликации данных и автоматизированного механизма создания резервных копий.

Система управления виртуализайией - VMWare, высокопроизводительное (для такого количества гостевых ОС) решение с 
готовыми средствами по решению задач балансировки, репликации, созданию резервных копий, с отличной совместимостью
с большинством образов гостевых операционных систем

- Требуется наиболее производительное бесплатное open source решение для виртуализации небольшой (20-30 серверов) 
инфраструктуры на базе Linux и Windows виртуальных машин.

Система управления виртуализацией - Xen, подходит под критерий наиболее производительного open-source решения
в рамках малой инфраструктуры

- Необходимо бесплатное, максимально совместимое и производительное решение для виртуализации Windows инфраструктуры.

Система управления виртуализацией - Hyper-V, в рамках лицензионной политики Microsoft, мы можем использовать
существующие программы лицензирования оборудования и на хостовые машины виртуализации - по факту можем обойтись без 
дополнительных лицензий, одноврменно с чем мы получаем отличную совместимость с Windows-инфраструктурой

- Необходимо рабочее окружение для тестирования программного продукта на нескольких дистрибутивах Linux.

Система управления виртуализацией - KVM(Proxmox), отлично совместимо с большим количеством дистрибутивов Linux,
активно развиваемое, с низким порогом вхождения

### Обязательная задача 4
Наша команда разрабатывает несколько веб-сервисов, доступных по http. Мы точно знаем, что на их стенде нет никакой балансировки, кластеризации, за DNS прячется конкретный IP сервера, где установлен сервис. Проблема в том, что отдел, занимающийся нашей инфраструктурой очень часто меняет нам сервера, поэтому IP меняются примерно раз в неделю, при этом сервисы сохраняют за собой DNS имена. Это бы совсем никого не беспокоило, если бы несколько раз сервера не уезжали в такой сегмент сети нашей компании, который недоступен для разработчиков. Мы хотим написать скрипт, который опрашивает веб-сервисы, получает их IP, выводит информацию в стандартный вывод в виде: <URL сервиса> - <его IP>. Также, должна быть реализована возможность проверки текущего IP сервиса c его IP из предыдущей проверки. Если проверка будет провалена - оповестить об этом в стандартный вывод сообщением: [ERROR] <URL сервиса> IP mismatch: <старый IP> <Новый IP>. Будем считать, что наша разработка реализовала сервисы: drive.google.com, mail.google.com, google.com.

```python
#!/usr/bin/env python3

import socket

dict_data = {}
urls = ["drive.google.com", "mail.google.com", "google.com"]
# Вывод скрипта о текущей проверке
for url in urls:
    ip = socket.gethostbyname(url)
    print("Текущий IP проверки сервиса " + url + " - " + ip)

# Если БД пустая - записываем сформированную структуру
with open('bd.txt', 'r+') as f:
    content = f.readlines()
    if len(content) == 0:
        print("БД пустая, пишем")
        for url in urls:
            ip = socket.gethostbyname(url)
            f.write(ip + "\n")
        exit()

# Считываем данные, сверяем с актуальными
with open('bd.txt', 'r') as f:
    list_ip = f.readlines()
    i = 0
    j = 0
    # Заполняем словарь старыми значениями IP из БД
    for url in urls:
        dict_data[url] = list_ip[i].replace("\n", "")
        i += 1
    # Проводим проверку с актуальными данными
    for url in urls:
        ip = socket.gethostbyname(url)
        if dict_data[url] == ip :
            print("IP адрес ресурса " + url + " не менялся, можно работать")
        else:
            print("IP адрес ресурса " + url + " изменился с " + dict_data[url] + " на " + ip + " записываем в БД")
            list_ip[j] = ip + "\n"
        j += 1
# Обновляем БД
with open('bd.txt', 'r+') as f:
    for ip in list_ip:
        f.write(ip)
```

Вывод скрипта при запуске при тестировании:
Если адрес изменился:
```python
Текущий IP проверки сервиса drive.google.com - 142.250.190.142
Текущий IP проверки сервиса mail.google.com - 142.250.190.101
Текущий IP проверки сервиса google.com - 142.250.190.78
IP адрес ресурса drive.google.com изменился с 142.250.191.142 на 142.250.190.142 записываем в БД
IP адрес ресурса mail.google.com изменился с 172.217.4.197 на 142.250.190.101 записываем в БД
IP адрес ресурса google.com изменился с 142.250.191.206 на 142.250.190.78 записываем в БД
```


Если адрес не менялся:
```python
Текущий IP проверки сервиса drive.google.com - 142.250.191.142
Текущий IP проверки сервиса mail.google.com - 172.217.4.197
Текущий IP проверки сервиса google.com - 142.250.191.206
IP адрес ресурса drive.google.com не менялся, можно работать
IP адрес ресурса mail.google.com не менялся, можно работать
IP адрес ресурса google.com не менялся, можно работать
`